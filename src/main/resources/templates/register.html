<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
    <title>登陆刷题网</title>
    <script th:src="@{/js/jquery.min.js}"></script>
    <script th:src="@{/js/progressbar.js}"></script>
    <script th:src="@{/js/jquery.serializejson.min.js}"></script>
    <link rel="stylesheet" th:href="@{/css/progressbar.css}">
</head>
<body>

<form id="registerForm" method="post">
    <fieldset>
        登陆名 <br>
        <input type="text" id="loginName" name="loginName" required="required" style="width:80;height:50;border-radius:10px"/> <br>
        登陆密码 <br>
        <input type="text" id="loginPassword" name="loginPassword" required="required" style="width:100;height:50;border-radius:10px"/> <br>
        儿童名字 <br>
        <input type="text" id="childName" name="childName" required="required" style="width:100;height:50;border-radius:10px"/> <br>
        儿童年龄 <br>
        <input type="number" id="childAge" name="childAge" required="required" style="width:100;height:50;border-radius:10px"/> <br>
        儿童性别 <br>
        <input type="text" id="childGender" name="childGender" required="required" style="width:100;height:50;border-radius:10px"/> <br>
        父母姓名 <br>
        <input type="text" id="parentName" name="parentName" required="required" style="width:100;height:50;border-radius:10px"/> <br>
        父母邮箱 <br>
        <input type="text" id="parentEmail" name="parentEmail" required="required" style="width:100;height:50;border-radius:10px"/> <br>
        激活码 <br>
        <input type="text" id="invitationCode" name="invitationCode" required="required" style="width:100;height:50;border-radius:10px"/> <br>
        <input type="button" id="REG" style="width:100px;height:60px;border-radius:10px" value="注册"/>
    </fieldset>
</form>

<a th:href="@{/}">返回</a>
<div id="divMask" style="filter:Alpha(opacity=30);display:none;background-color:#ffffff;bottom:0;z-index:1;">
    <!--此div用于展示进度条的图片-->
    <div id="divLoad" style="display:none;z-index:4;">
        <div id="processId" class="progress hearts" data-width="0%">
            <div class="progress-text">0%</div>
            <div class="progress-bar">
                <div class="progress-text">0%</div>
            </div>
        </div>
        <!--  <input id="slider" type="range" name="slider" min="0" max="100" value="0" >-->
    </div>
</div>
</body>
<script th:inline="none">
    /*乐天派又在写代码咯*/
    $("#REG").click(beforeReg);
    function beforeReg(){
      closeProgress();
      randomProcessStyle();
      showMask();
          var i=0;
          var timer=setInterval(function(){
                  if(i<100){
                      i+=1;
                      console.log(i);
                      $('.progress-bar').css('width',i+'%');
                  }
                  if(i>=99){
                      clearInterval(timer);
                  }
          },99);
          doTheReg(timer);
    }
    function doTheReg(timer){
        $.ajax({
            url:"/auth/doReg",
            data: $('#registerForm').serializeJSON(),
            type:"post",
            dataType:"JSON",
            success:function(data){
            console.log('onsuccess')
             if(data.code==1){
              $('.progress-bar').css('width',100+'%');
              window.location.href='/';
             }else{
               $('.progress-bar').css('width',0+'%');
             }
               console.log(data);
               clearInterval(timer);

<!--                window.location.reload();-->
            },
            error: function (errormessage) {
            console.log('on error:'+JSON.stringify(errormessage));
                //do something else
                clearInterval(timer);
                $('.progress-bar').css('width',0+'%');
                closeProgress();
            }
        })
    }
    function closeProgress(){
       hideMask();
       $('.progress-bar').css('width',0+'%');
    }
<!--    $('#bk').click(closeProgress);-->

//加载loading
function showMask(){
 console.log('loading...');
 var divMask = document.getElementById("divMask");
 var divLoad = document.getElementById("divLoad");
 divMask.style.display="block";
 var vwidth = document.body.offsetWidth+20;
 var vheitht = document.body.offsetHeight;
 divMask.style.width=vwidth;
 divMask.style.height=vheitht;
 divLoad.style.display="block";
 divLoad.style.top=(vheitht-200)/2;
 divLoad.style.left=(vwidth-200)/2;
}
//隐藏loading
function hideMask(){
 var divMask = document.getElementById("divMask");
 var divLoad = document.getElementById("divLoad");
 divMask.style.display="none";
 divLoad.style.display="none";
}
function sleep(numberMillis) {
  var now = new Date();
  var exitTime = now.getTime() + numberMillis;
  while (true) {
  now = new Date();
  if (now.getTime() > exitTime)
  return;
  }
}
function randomProcessStyle(){
    var progressType =
    ['progress aqua','progress copper','progress candy','progress neon',
    'progress shine','progress zigzag','progress diamond','progress hearts',
    'progress sparkle'];
    console.log('random:'+parseInt(Math.random() * progressType.length, 10));
    $("#processId").attr("class",progressType[parseInt(Math.random() * progressType.length, 10)]);
}

</script>
</html>